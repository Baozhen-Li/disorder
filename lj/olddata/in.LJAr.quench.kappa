#variable a loop 5
#variable seed index 55555 66666 77777 88888 99999 
clear
# Lennard-Jones Melt
#------------Prepare Geometry---------------------------------------------------------------
units			lj
atom_style		atomic
read_data		LJ_rand_mass_binary.in.data
#read_restart 	ljNVE.restart.1000000
#------------Initialize Structure-----------------------------------------------------------
#mass           	1  1.0
#group         	Ar type = 1
#------------LJ Potentials------------------------------------------------------------------
pair_style		lj/cut 2.5
pair_coeff		* * 1.0 1.0
pair_modify          shift yes
#pair_modify   	tail no
#------------Variables----------------------------------------------------------------------
#------------LJ Parameters
variable    	kB 		equal 1.3806504e-23 	# [J/K] Boltzmann
variable	sigma_Ar 	equal 3.4e-10 	# m
variable	eps_Ar		equal 1.67e-21	# J
variable	mass_Ar	equal 6.63e-26	# kg
variable	tau_Ar		equal 2.1423e-12	# s
#------------thermo Parameters
variable    	T_melt 	equal 300*(${kB}/${eps_Ar})
variable	T_0K		equal 0.001
#variable	T_run		equal 15*(${kB}/${eps_Ar})
#variable    	V 		equal vol
variable   	dt 		equal 0.002
variable	quench_rate	equal 1.0
variable	quench_length equal 10000
#------------kappa parameters
variable    	p 		equal 1000 		# correlation length
variable    	s 		equal 5  		# sample interval
variable    	d 		equal $p*$s 		# dump interval 



log log_main.lammps

	#------------ NVT RUN -----------------------------------------------------------------------
	velocity		all create ${T_melt} 99999 dist gaussian mom yes
	fix 			1 all nvt temp ${T_melt} ${T_melt} 10.0
	compute 		myDis all msd 
	thermo_style  	custom step temp press etotal pe ke vol xlo xhi ylo yhi zlo zhi c_myDis[4]
	thermo			500
	timestep		${dt}
	run			100000
#	run			2500
	unfix 1
	uncompute 		myDis
	#------------ NVE RUN -----------------------------------------------------------------------
	fix 			1 all nve
	compute 		myDis all msd 
	compute 		temp all temp
	fix 			temp all ave/time 100 10 1000 c_temp mode scalar
	variable		avgTemp equal f_temp
	thermo_style  	custom step temp press etotal pe ke vol xlo xhi ylo yhi zlo zhi c_myDis[4]
	thermo			500
	timestep		${dt}
	run			100000
#	run			2500
	unfix 1
	uncompute 		myDis
	unfix			temp

	#------------ NVE quench ---------------------------------------------------------------------
	fix 			1 all nve
	fix 			2 all temp/rescale 1 ${T_melt} ${T_0K} 0.01 1.0
	thermo_style  	custom step temp press etotal pe ke vol
	thermo			500
#	run			${quench_length}
	run			2500
	unfix 1 
	unfix 2

	#------------ NPT Relax -----------------------------------------------------------------------
	reset_timestep  	0
	fix 			1 all npt temp ${T_0K} ${T_0K} 10.0 iso 0.0 0.0 10.0
	compute 		myDis all msd 
	dump 			xyz all xyz 100000 npt_relax_from_300K.dump
	compute 		rdf all rdf 100
	fix 			rdf all ave/time 100 10 1000 c_rdf file npt_relax_from_300K.rdf mode vector
	thermo_style  	custom step temp press etotal pe ke vol xlo xhi ylo yhi zlo zhi c_myDis[4]
	thermo			500
	run			100000
#	run			1000
	undump			xyz
	unfix 			1
	uncompute 		myDis
	unfix 			rdf
	uncompute 		rdf

	#------------ NPT Anneal 10K --------------------------------------------------------------------
	reset_timestep  	0
	fix 			1 all npt temp ${T_0K} 0.082670659 10.0 iso 0.0 0.0 10.0
	compute 		myDis all msd 
	dump 			xyz all xyz 100000 npt_anneal.dump
	compute 		rdf all rdf 100
	fix 			rdf all ave/time 100 10 1000 c_rdf file npt_anneal.rdf mode vector
	thermo_style  	custom step temp press etotal pe ke vol xlo xhi ylo yhi zlo zhi c_myDis[4]
	thermo			500
	run			500000
#	run			1000
	undump			xyz
	unfix 			1
	uncompute 		myDis
	unfix 			rdf
	uncompute 		rdf

	#------------ NPT Relax -----------------------------------------------------------------------
	reset_timestep  	0
	fix 			1 all npt temp 0.124005988 ${T_0K} 10.0 iso 0.0 0.0 10.0
	compute 		myDis all msd 
	thermo_style  	custom step temp press etotal pe ke vol xlo xhi ylo yhi zlo zhi c_myDis[4]
	thermo			500
	run			100000
#	run			1000
	unfix 			1
	uncompute 		myDis



label loop
variable a loop 5
variable T_run index 0.041335329 0.082670659 0.124005988 0.165341317 0.206676647

log 	log_quench_$a.lammps

	#------------ NPT Heat -----------------------------------------------------------------------
	reset_timestep  	0
	fix 			1 all npt temp ${T_run} ${T_run} 10.0 iso 0.0 0.0 10.0
	compute 		myDis all msd 
	dump 			xyz all xyz 100000 npt_heat_$a.dump
	#----------Calculate Avg Cell Size-----------------------------------------------------------	
	variable  		myLx equal xhi-xlo
	fix 			myLx all ave/time 100 10 1000 v_myLx file Lx.profile$a
	variable		myLx2 equal f_myLx
	compute 		rdf all rdf 100
	fix 			rdf all ave/time 100 10 1000 c_rdf file npt_heat_$a.rdf mode vector
	thermo_style  	custom step temp press etotal pe ke vol xlo xhi ylo yhi zlo zhi c_myDis[4]
	thermo			500
	run			500000
#	run			10000
	undump			xyz
	unfix 			1
	fix 			deform all deform 1 x final 0.0 ${myLx2} y final 0.0 ${myLx2} z final 0.0 ${myLx2} units box
	run			10000
	unfix			deform
	unfix			myLx	
	uncompute 		myDis
	unfix 			rdf
	uncompute 		rdf

	#------------ NVT equil -----------------------------------------------------------------------

	fix 			1 all nvt temp ${T_run} ${T_run} 10.0
	compute 		myDis all msd 
	thermo_style  	custom step temp press etotal pe ke vol xlo xhi ylo yhi zlo zhi c_myDis[4]
	thermo			500
	run			250000
#	run			2500
	unfix 1 
	uncompute 		myDis

	#------------ kappa -------------------------------------------------------------------------	
	reset_timestep  	0
	fix 			1 all nve
	timestep		${dt}
	compute 		myDis all msd 
	thermo_style  	custom step temp press etotal pe ke vol xlo xhi ylo yhi zlo zhi c_myDis[4]
	thermo			500
	run			250000	
#	run			2500
	unfix 			1
	uncompute 		myDis

log 	log_kappa$a.lammps
	reset_timestep  	0
	fix 			1 all nve
	compute   		myKE all ke/atom
	compute   		myPE all pe/atom
	compute   		myStress all stress/atom virial
	compute   		flux all heat/flux myKE myPE myStress
	variable  		Jx equal c_flux[1]/vol
	variable  		Jy equal c_flux[2]/vol
	variable  		Jz equal c_flux[3]/vol
#	fix       		JJ all ave/correlate $s $p $d c_flux[1] c_flux[2] c_flux[3] type auto file J0Jt_$a.dat ave running
	fix       		JJ all ave/correlate $s $p $d c_flux[1] c_flux[2] c_flux[3] type auto ave running
#	dump			JJ all custom 1000000 J0Jt.dat f_JJ[3] f_JJ[4] f_JJ[5]
	compute 		myDis all msd 
	dump 			xyz all xyz 500000 nve_kappa_dump.$a
	thermo_style 		custom step temp press etotal pe ke vol c_myDis[4] v_Jx v_Jy v_Jz 
	thermo			5
	timestep		${dt}
	run			2000000
#	run			2500
	unfix			1
	uncompute		myKE
	uncompute		myPE
	uncompute		myStress
	uncompute		flux
	undump			xyz
	uncompute		myDis
	unfix			JJ

next T_run
next a
jump in.LJAr.quench.kappa loop